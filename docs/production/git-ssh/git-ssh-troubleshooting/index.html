<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <!-- favicon -->
    <link href='/images/favicon.ico' rel='icon' type='image/png'>
    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>
      Git & SSH Troubleshooting - Nanobox Production Documentation
    </title>
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href="/stylesheets/all-f8ad495b.css" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all-ed5924a1.js" type="text/javascript"></script>
  </head>
  <body>
    <div id='header'>
      <a class='left' href='/' id='logo'>
        <svg enable-background='new 0 0 19 33' id='nanobox-logo' space='preserve' version='1.1' viewbox='0 0 19 33' x='0px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' y='0px'>
          <g>
            <g>
              <polygon fill='#405C70' points='19,26 9.6,30.9 0,26 9.4,21.1'></polygon>
              <polygon fill='#2F4352' points='15,24 9.5,26.9 3.9,24 9.4,21.1'></polygon>
              <polygon fill='#1C2830' points='9.6,30.9 19,26.1 19,27.4 9.6,32.3 '></polygon>
              <polygon fill='#19242B' points='9.6,30.9 0,26 0,27.3 9.6,32.3 '></polygon>
            </g>
            <g>
              <polygon fill='#1E77A3' points='9.5,23.1 17.2,19.1 17.2,20.3 9.5,24.2 '></polygon>
              <polygon fill='#175D80' points='9.5,23.1 1.8,19.1 1.8,20.3 9.5,24.2 '></polygon>
              <polygon fill='#62B1DD' points='17.2,19.1 9.5,23.1 1.8,19.1 9.5,15.2'></polygon>
              <polygon enable-background='new' fill='#0B194F' opacity='0.42' points='15.1,18.1 9.5,21 3.9,18.1 9.5,15.2 '></polygon>
            </g>
            <g>
              <polygon fill='#43C494' points='9.5,16.9 18.8,12.2 18.8,13.5 9.5,18.3 '></polygon>
              <polygon fill='#4AAA88' points='9.5,16.9 0.2,12.2 0.2,13.5 9.5,18.3 '></polygon>
              <polygon fill='#7FE0BF' points='18.8,12.2 9.5,16.9 0.2,12.2 9.5,7.4 '></polygon>
              <polygon enable-background='new' fill='#43C4A6' opacity='0.76' points='16.3,10.9 9.5,14.4 2.7,10.9 9.5,7.4'></polygon>
            </g>
            <g>
              <polygon fill='#FDE5A6' points='18.8,4.8 9.5,9.6 0.2,4.8 9.5,0'></polygon>
              <polygon fill='#E9D399' points='9.5,9.6 18.8,4.8 18.8,6.2 9.5,11'></polygon>
              <polygon fill='#D9BB6F' points='9.5,9.6 0.2,4.8 0.2,6.2 9.5,11'></polygon>
            </g>
          </g>
        </svg>
        <span id='nb-title'>
          <span class='drop'>Nanobox</span>
          Docs
        </span>
      </a>
      <ul class='links'>
        <li class='text'>
          <a href='/'>
            Local
          </a>
        </li>
        <li class='text'>
          <a class='active' href='/production/'>
            Production
          </a>
        </li>
        <li>
          <a href='http://nanobox.io'>
            <svg enable-background='new 0 0 18 18' id='home-icon' space='preserve' version='1.1' viewbox='0 0 18 18' x='0px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' y='0px'>
              <polygon fill='none' points='11,13 11,9 9,7 7,9 &#x000A;	7,13 ' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2'></polygon>
              <polyline fill='none' points='14,11 14,16 4,16 &#x000A;	4,11 ' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2'></polyline>
              <polyline fill='none' points='2,9.1 9.1,2 &#x000A;	16.1,9.1 ' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2'></polyline>
            </svg>
          </a>
        </li>
      </ul>
    </div>
    <div id='wrapper'>
      <div class='open' id='contents-btn'>Contents</div>
      <div id='navigation'>
        <ul class='closed' id='contents'>
          <li>
            <a href="/production/">Nanobox Production</a>
          </li>
          <li>
            <a href="/production/getting-started/">Getting Started</a>
            <ul class='sub'>
              <li>
                <a href="/production/getting-started/local-to-production/">Going from Local to Production</a>
              </li>
              <li>
                <a href="/production/getting-started/environment/">The Environment</a>
              </li>
              <li>
                <a href="/production/getting-started/providers/">Available Providers</a>
              </li>
              <li>
                <a href="/production/getting-started/nanoagent/">NanoAgent</a>
              </li>
              <li>
                <a href="/production/getting-started/launching-an-app/">Launching an App</a>
              </li>
              <li>
                <a href="/production/getting-started/deploy-process/">The Deploy Process</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/production/git-ssh/">Git & SSH</a>
            <ul class='sub'>
              <li>
                <a href="/production/git-ssh/generating-ssh-keys/">Generating SSH Keys</a>
              </li>
              <li>
                <a href="/production/git-ssh/adding-ssh-keys/">Adding SSH Keys to Nanobox</a>
              </li>
              <li class='active'>
                <a href="/production/git-ssh/git-ssh-troubleshooting/">Git & SSH Troubleshooting</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/production/app-management/">App Management</a>
            <ul class='sub'>
              <li>
                <a href="/production/app-management/service-stats/">Service Stats</a>
              </li>
              <li>
                <a href="/production/app-management/cron-jobs/">Cron Jobs</a>
              </li>
              <li>
                <a href="/production/app-management/log-management/">Log Management</a>
              </li>
              <li>
                <a href="/production/app-management/deploy-history/">Deploy History</a>
              </li>
              <li>
                <a href="/production/app-management/dashboard-service-controls/">Dashboard Service Controls</a>
              </li>
              <li>
                <a href="/production/app-management/deployment-options/">Deployment Options</a>
              </li>
              <li>
                <a href="/production/app-management/app-public-ssh-key/">App Public SSH Key</a>
              </li>
              <li>
                <a href="/production/app-management/mail/">Mail</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/production/data-management/">Data Management</a>
            <ul class='sub'>
              <li>
                <a href="/production/data-management/remotely-managing-data/">Remotely Managing Data</a>
              </li>
              <li>
                <a href="/production/data-management/snapshots-backups/">Snapshots & Backups</a>
              </li>
              <li>
                <a href="/production/data-management/data-migrations-scaling/">Data Migrations During Scaling & Repairs</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/production/scaling/">Scaling</a>
            <ul class='sub'>
              <li>
                <a href="/production/scaling/single-vs-multi-node/">Single-Node & Multi-Node Apps</a>
              </li>
              <li>
                <a href="/production/scaling/how-when-to-scale/">How & When to Scale</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/production/networking/">Networking</a>
            <ul class='sub'>
              <li>
                <a href="/production/networking/custom-domains/">Using Custom Domains</a>
              </li>
              <li>
                <a href="/production/networking/adding-ssl/">Adding SSL</a>
              </li>
              <li>
                <a href="/production/networking/inbound-ips/">Inbound IPs</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/production/cli/">Command Line Interface</a>
          </li>
          <li>
            <a href="/production/team/">Team Management</a>
            <ul class='sub'>
              <li>
                <a href="/production/team/managing-collaborators/">Managing Collaborators</a>
              </li>
              <li>
                <a href="/production/team/collaborator-permissions/">Collaborator Permissions</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/production/account/">Account Management & Billing</a>
            <ul class='sub'>
              <li>
                <a href="/production/account/creating-an-account/">Creating an Account</a>
              </li>
              <li>
                <a href="/production/account/removing-an-account/">Removing an Account</a>
              </li>
              <li>
                <a href="/production/account/card-management/">Credit Card Management</a>
              </li>
              <li>
                <a href="/production/account/invoicing/">Invoicing</a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
      <div id='content'>
        <h1>Git & SSH Troubleshooting</h1>
        <h2 id="confirm-you-39-ve-added-your-ssh-key-to-your-user-account">Confirm You&#39;ve Added Your SSH Key to Your User Account</h2>
        
        <p>In order for Git/SSH to successfully authorize with Nanobox, you must first add your public SSH key to your Nanobox account. You can see what SSH key(s) you&#39;ve added to your account by clicking on your user image in the upper right corner of your dashboard and going to Account Admin &gt; SSH Keys.</p>
        
        <p>If no SSH keys have been added, the <a href="/production/git-ssh/adding-ssh-keys/">Adding SSH Keys doc</a> walks through how.</p>
        
        <h2 id="ssh-authorization-failure-amp-ssh-fingerprint">SSH Authorization Failure &amp; SSH Fingerprint</h2>
        
        <p>Whenever you try to connect to Nanobox through an SSH connection, your local machine sends one of the keys you&#39;ve added to your local SSH agent. Every SSH key has a fingerprint. Whenever there&#39;s an SSH authorization error, the fingerprint of the SSH key sent with the connection request is displayed in the error output.</p>
        
        <h4 id="example-ssh-authorization-failure">Example SSH Authorization Failure</h4>
        <pre class="highlight shell"><code>::::::::::::::::: AUTHORIZATION FAILURE !!!&#x000A;&#x000A;Sorry, the SSH key provided is not authorized <span class="k">for </span>this repo.&#x000A;&#x000A;ssh fingerprint provided: aa:bb:cc:dd:ee:ff:00:11:22:33:44:55:66:77:88:99&#x000A;</code></pre>
        
        <p>This is the fingerprint of the key your machine sent when trying to authorize the SSH connection.</p>
        
        <h2 id="compare-fingerprints">Compare Fingerprints</h2>
        
        <p>The fingerprints of each SSH key you&#39;ve added to your account are shown in your dashboard. Compare the fingerprint shown in the error output to the SSH fingerprint(s) of the key(s) added to your Nanobox account.</p>
        
        <p><img alt="SSH Fingerprints in Dashboard" src="/images/ssh-troubleshooting-fingerprints-lg-4c217e24.png" /></p>
        
        <h3 id="the-fingerprint-matches-a-key-added-to-your-account">The Fingerprint Matches a Key Added to Your Account</h3>
        
        <p>If the fingerprint shown in the connection error output does match a key added to your account, it means you&#39;re trying to connect to a service or push to an app that your user account does not have access to. You have not been <a href="/production/team/">added as a team member</a> on the app. It could also mean that the git clone url tied to the remote to which you&#39;re trying to push is wrong (more info <a href="#check-your-git-remote-39-s-clone-url">below</a>).</p>
        
        <h3 id="the-fingerprint-does-not-match-a-key-added-to-your-account">The Fingerprint Does NOT Match a Key Added to Your Account</h3>
        
        <p>If the fingerprint shown in the SSH connection error does not match any key added to your user account, it means your local machine is sending a key that Nanobox doesn&#39;t know about. To see exactly which key is being sent, you&#39;ll need to compare the fingerprint shown in the SSH authorization error output with the fingerprints of your local keys.</p>
        
        <p>To view the fingerprints of the keys added to your local SSH agent, run the following:</p>
        
        <h4 id="viewing-local-ssh-fingerprints">Viewing Local SSH Fingerprints</h4>
        <pre class="highlight plaintext"><code>$ ssh-add -l&#x000A;</code></pre>
        
        <h5 id="fingerprint-matches-a-local-key">Fingerprint Matches a Local Key</h5>
        
        <p>If the fingerprint shown in the authorization error output does match a local key, you have two options:</p>
        
        <ol>
        <li><p>Add the matching key to your Nanobox account. The <a href="/production/git-ssh/adding-ssh-keys/">Adding SSH Keys doc</a> explains how.</p></li>
        <li><p>If you have multiple keys locally, the SSH agent is likely sending the wrong one. You can <a href="#specify-which-key-to-use-with-nanobox">specify which key the SSH agent should use</a> when pushing to Nanobox.</p></li>
        </ol>
        
        <h5 id="fingerprint-does-not-match-a-local-key">Fingerprint Does NOT Match a Local Key</h5>
        
        <p>If the fingerprint shown in the authorization error does NOT match any of the keys registered to your local SSH-agent, it means your local SSH agent doesn&#39;t know about the key that&#39;s being used. In this case, you&#39;ll need to add all your generated keys to your local SSH-agent.</p>
        
        <h4 id="adding-keys-to-your-local-ssh-agent-terminal">Adding Keys to Your Local SSH Agent Terminal</h4>
        <pre class="highlight shell"><code><span class="c"># List keys stored in your .ssh directory</span>&#x000A;<span class="gp">$ </span>ls ~/.ssh&#x000A;&#x000A;<span class="c"># Add a key pair to your ssh agent</span>&#x000A;<span class="gp">$ </span>ssh-add ~/.ssh/keyname&#x000A;</code></pre>
        
        <p>Below is a quick example of the workflow:</p>
        
        <h4 id="example-of-adding-keys-to-your-local-ssh-agent">Example of Adding Keys to Your Local SSH Agent</h4>
        <pre class="highlight shell"><code><span class="gp">$ </span>ls ~/.ssh&#x000A;github_rsa  github_rsa.pub id_rsa  id_rsa.pub  known_hosts nanobox_rsa  nanobox_rsa.pub&#x000A;&#x000A;<span class="gp">$ </span>ssh-add ~/.ssh/github_rsa&#x000A;Identity added: github_rsa <span class="o">(</span>github_rsa<span class="o">)</span>&#x000A;&#x000A;<span class="gp">$ </span>ssh-add ~/.ssh/id_rsa&#x000A;Identity added: id_rsa <span class="o">(</span>id_rsa<span class="o">)</span>&#x000A;&#x000A;<span class="gp">$ </span>ssh-add ~/.ssh/nanobox_rsa&#x000A;Identity added: nanobox_rsa <span class="o">(</span>nanobox_rsa<span class="o">)</span>&#x000A;</code></pre>
        
        <p>Now if you run <code>ssh-add -l</code>, you&#39;ll see the newly added keys and their fingerprints. Compare the newly added key fingerprints to the key shown in the SSH authorization output and take any <a href="#viewing-local-ssh-fingerprints">appropriate steps</a>.</p>
        
        <h2 id="specify-which-key-to-use-with-nanobox">Specify Which Key to Use with Nanobox</h2>
        
        <p>By default, your local SSH agent will use the default key, <code>id_rsa</code>. However if you didn&#39;t use the default name or you&#39;ve created multiple keys, you need to tell the SSH agent which key to use when pushing to Nanobox. This is done in your local SSH config file located at <code>~/.ssh/config</code>.</p>
        
        <h4 id="ssh-config">SSH Config</h4>
        <pre class="highlight plaintext"><code>Host git.nanobox.io&#x000A;    User git&#x000A;    Hostname git.nanobox.io&#x000A;    PreferredAuthentications publickey&#x000A;    IdentityFile ~/.ssh/keyname&#x000A;</code></pre>
        
        <p>You may also need to update the permissions on your .ssh folder and its contents. The SSH application will ignore secret files that are too permissive.</p>
        
        <h4 id="update-ssh-permissions">Update .ssh Permissions</h4>
        <pre class="highlight shell"><code><span class="gp">$ </span>chmod 700 ~/.ssh&#x000A;<span class="gp">$ </span>chmod 600 ~/.ssh/<span class="k">*</span>&#x000A;</code></pre>
        
        <h2 id="ssh-keys-in-non-default-location-or-using-non-default-name">SSH Keys in Non-Default Location or using Non-Default Name</h2>
        
        <p>If your key is not at the default location (<code>~/.ssh/</code>) or it&#39;s using a Non-Default Name (<code>id_rsa</code>), move or rename it. Or run the following command to make SSH aware of it&#39;s existence.</p>
        
        <h4 id="add-ssh-key-path-terminal">Add SSH Key Path Terminal</h4>
        <pre class="highlight shell"><code><span class="gp">$ </span>ssh-add path/to/key&#x000A;</code></pre>
        
        <h2 id="ssh-keys-generated-using-different-user">SSH Keys Generated Using Different User</h2>
        
        <p>Keep in mind that SSH keys are user specific. If you generated keys using <code>sudo ssh-keygen</code>, then those keys will only be available to sudo. You can either run all your <code>git</code> commands as sudo (not recommended) or regenerate SSH keys for your user and add the new public key (<code>id_rsa.pub</code>) to your Nanobox account.</p>
        
        <h2 id="check-your-git-remote-39-s-clone-url">Check Your Git Remote&#39;s Clone URL</h2>
        
        <p>Make sure the clone url tied to the remote to which you&#39;re pushing matches the clone url of your app.</p>
        
        <h4 id="view-your-remotes-39-clone-urls">View Your Remotes&#39; Clone URLs</h4>
        <pre class="highlight shell"><code><span class="gp">$ </span>git remote -v&#x000A;nanobox  git@git.pagodabox.io:apps/app-name.git <span class="o">(</span>fetch<span class="o">)</span>&#x000A;nanobox  git@git.pagodabox.io:apps/app-name.git <span class="o">(</span>push<span class="o">)</span>&#x000A;</code></pre>
        
        <p>Ensure the clone url of the remote to which you&#39;re trying to push exactly matches the clone url of your app. Your app&#39;s clone URL can be found in your dashboard under Admin &gt; App Info.</p>
        <div id='pagination'>
          <a class="prev" href="/production/git-ssh/adding-ssh-keys/">Adding SSH Keys to Nanobox</a>
          <a class="next" href="/production/app-management/">App Management</a>
        </div>
      </div>
    </div>
    <div id='footer'></div>
  </body>
</html>
