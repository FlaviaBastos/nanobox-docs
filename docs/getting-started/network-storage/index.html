<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <!-- favicon -->
    <link href='/images/favicon.ico' rel='icon' type='image/png'>
    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>
      Network Storage - Nanobox Documentation
    </title>
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href="/stylesheets/all-3f3c7979.css" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all-e3f637d0.js" type="text/javascript"></script>
  </head>
  <body>
    <div id='header'>
      <a class='left' href='/' id='logo'>
        <svg enable-background='new 0 0 19 33' id='nanobox-logo' space='preserve' version='1.1' viewbox='0 0 19 33' x='0px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' y='0px'>
          <g>
            <g>
              <polygon fill='#405C70' points='19,26 9.6,30.9 0,26 9.4,21.1'></polygon>
              <polygon fill='#2F4352' points='15,24 9.5,26.9 3.9,24 9.4,21.1'></polygon>
              <polygon fill='#1C2830' points='9.6,30.9 19,26.1 19,27.4 9.6,32.3 '></polygon>
              <polygon fill='#19242B' points='9.6,30.9 0,26 0,27.3 9.6,32.3 '></polygon>
            </g>
            <g>
              <polygon fill='#1E77A3' points='9.5,23.1 17.2,19.1 17.2,20.3 9.5,24.2 '></polygon>
              <polygon fill='#175D80' points='9.5,23.1 1.8,19.1 1.8,20.3 9.5,24.2 '></polygon>
              <polygon fill='#62B1DD' points='17.2,19.1 9.5,23.1 1.8,19.1 9.5,15.2'></polygon>
              <polygon enable-background='new' fill='#0B194F' opacity='0.42' points='15.1,18.1 9.5,21 3.9,18.1 9.5,15.2 '></polygon>
            </g>
            <g>
              <polygon fill='#43C494' points='9.5,16.9 18.8,12.2 18.8,13.5 9.5,18.3 '></polygon>
              <polygon fill='#4AAA88' points='9.5,16.9 0.2,12.2 0.2,13.5 9.5,18.3 '></polygon>
              <polygon fill='#7FE0BF' points='18.8,12.2 9.5,16.9 0.2,12.2 9.5,7.4 '></polygon>
              <polygon enable-background='new' fill='#43C4A6' opacity='0.76' points='16.3,10.9 9.5,14.4 2.7,10.9 9.5,7.4'></polygon>
            </g>
            <g>
              <polygon fill='#FDE5A6' points='18.8,4.8 9.5,9.6 0.2,4.8 9.5,0'></polygon>
              <polygon fill='#E9D399' points='9.5,9.6 18.8,4.8 18.8,6.2 9.5,11'></polygon>
              <polygon fill='#D9BB6F' points='9.5,9.6 0.2,4.8 0.2,6.2 9.5,11'></polygon>
            </g>
          </g>
        </svg>
        <span id='nb-title'>
          <span class='drop'>Nanobox</span>
          Docs
        </span>
      </a>
      <ul class='links'>
        <li class='text'>
          <a class='active' href='/'>
            Local
          </a>
        </li>
        <li class='text'>
          <a href='/production/intro/'>
            Production
          </a>
        </li>
        <li>
          <a href='http://nanobox.io'>
            <svg enable-background='new 0 0 18 18' id='home-icon' space='preserve' version='1.1' viewbox='0 0 18 18' x='0px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' y='0px'>
              <polygon fill='none' points='11,13 11,9 9,7 7,9 &#x000A;	7,13 ' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2'></polygon>
              <polyline fill='none' points='14,11 14,16 4,16 &#x000A;	4,11 ' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2'></polyline>
              <polyline fill='none' points='2,9.1 9.1,2 &#x000A;	16.1,9.1 ' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2'></polyline>
            </svg>
          </a>
        </li>
      </ul>
    </div>
    <div id='wrapper'>
      <div class='open' id='contents-btn'>Contents</div>
      <div id='navigation'>
        <ul class='closed' id='contents'>
          <li>
            <a href="/">Overview</a>
          </li>
          <li>
            <a href="/why-nanobox/">Why Nanobox?</a>
          </li>
          <li>
            <a href="/installation/installing-nanobox/">Installation</a>
            <ul class='sub'>
              <li>
                <a href="/installation/upgrading/">Upgrading</a>
              </li>
              <li>
                <a href="/installation/uninstalling/">Uninstalling</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/getting-started/intro/">Getting Started</a>
            <ul class='sub'>
              <li>
                <a href="/getting-started/project-setup/">Project Setup</a>
              </li>
              <li>
                <a href="/getting-started/nanofile/">.nanofile</a>
              </li>
              <li>
                <a href="/getting-started/boxfile/">Boxfile</a>
              </li>
              <li>
                <a href="/getting-started/engines/">Engines</a>
              </li>
              <li>
                <a href="/getting-started/services/">Services</a>
              </li>
              <li>
                <a href="/getting-started/logs/">Logs</a>
              </li>
              <li>
                <a href="/getting-started/deploys/">Deploys</a>
              </li>
              <li>
                <a href="/getting-started/tunneling/">Tunneling</a>
              </li>
              <li class='active'>
                <a href="/getting-started/network-storage/">Network Storage</a>
              </li>
              <li>
                <a href="/getting-started/nonpersistent-writable-dirs/">Nonpersistent Writable Directories</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/cli/intro/">Command Line Interface</a>
            <ul class='sub'>
              <li>
                <a href="/cli/bootstrap/">bootstrap</a>
              </li>
              <li>
                <a href="/cli/build/">build</a>
              </li>
              <li>
                <a href="/cli/console/">console</a>
              </li>
              <li>
                <a href="/cli/create/">create</a>
              </li>
              <li>
                <a href="/cli/deploy/">deploy</a>
              </li>
              <li>
                <a href="/cli/destroy/">destroy</a>
              </li>
              <li>
                <a href="/cli/exec/">exec</a>
              </li>
              <li>
                <a href="/cli/fetch/">fetch</a>
              </li>
              <li>
                <a href="/cli/halt/">halt</a>
              </li>
              <li>
                <a href="/cli/help/">help</a>
              </li>
              <li>
                <a href="/cli/init/">init</a>
              </li>
              <li>
                <a href="/cli/log/">log</a>
              </li>
              <li>
                <a href="/cli/new/">new</a>
              </li>
              <li>
                <a href="/cli/publish/">publish</a>
              </li>
              <li>
                <a href="/cli/reload/">reload</a>
              </li>
              <li>
                <a href="/cli/resume/">resume</a>
              </li>
              <li>
                <a href="/cli/status/">status</a>
              </li>
              <li>
                <a href="/cli/suspend/">suspend</a>
              </li>
              <li>
                <a href="/cli/tunnel/">tunnel</a>
              </li>
              <li>
                <a href="/cli/up/">up</a>
              </li>
              <li>
                <a href="/cli/update/">update</a>
              </li>
              <li>
                <a href="/cli/upgrade/">upgrade</a>
              </li>
              <li>
                <a href="/cli/watch/">watch</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/boxfile/intro/">Boxfile</a>
            <ul class='sub'>
              <li>
                <a href="/boxfile/env/">env</a>
              </li>
              <li>
                <a href="/boxfile/build/">build</a>
              </li>
              <li>
                <a href="/boxfile/code-services/">Code Services</a>
              </li>
              <li>
                <a href="/boxfile/data-services/">Data Services</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/engines/intro/">Engines</a>
            <ul class='sub'>
              <li>
                <a href="/engines/how-engines-work/">How Engines Work</a>
              </li>
              <li>
                <a href="/engines/boxfile-spec/">Generating a Boxfile</a>
              </li>
              <li>
                <a href="/engines/project-creation/">Project Creation</a>
              </li>
              <li>
                <a href="/engines/enginefile/">Enginefile</a>
              </li>
              <li>
                <a href="/engines/style-guide/">Style Guide</a>
              </li>
              <li>
                <a href="/engines/scripts/intro/">Scripts</a>
                <ul class='sub'>
                  <li>
                    <a href="/engines/scripts/sniff/">sniff</a>
                  </li>
                  <li>
                    <a href="/engines/scripts/prepare/">prepare</a>
                  </li>
                  <li>
                    <a href="/engines/scripts/boxfile/">boxfile</a>
                  </li>
                  <li>
                    <a href="/engines/scripts/build/">build</a>
                  </li>
                  <li>
                    <a href="/engines/scripts/cleanup/">cleanup</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="/engines/common-tasks/intro/">Common Tasks</a>
                <ul class='sub'>
                  <li>
                    <a href="/engines/common-tasks/installing-binaries/">Installing Binaries</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/generating-output/">Generating Output</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/working-with-input/">Working with Input</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/validation/">Validation</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/caching/">Caching</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/environment-variables/">Environment Variables</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/template-generation/">Template Generation</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/application-config/">Application Configuration</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="/engines/publish/">Publish</a>
              </li>
              <li>
                <a href="/engines/dev-workflow/">Development Workflow</a>
              </li>
              <li>
                <a href="/engines/debugging/">Debugging</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/other/intro/">Other</a>
          </li>
        </ul>
      </div>
      <div id='content'>
        <h1>Network Storage</h1>
        <p>In some cases, it may be necessary to store files in your app&#39;s filesystem. In a traditional hosting environment, apps run on a single server with both source code and all auxiliary services using the same server resources and filesystem. In Nanobox however, apps consist of &quot;micro-services&quot; - isolated virtual instances, each with their own resources and filesystems, networked together inside of a virtual machine. In order for written files to be consistent across all services/instances in your app, they must be written to a single filesystem shared with other services. This is where network storage comes in.</p>
        
        <h2 id="understanding-file-consistency-in-a-distributed-architecture">Understanding File Consistency in a Distributed Architecture</h2>
        
        <p>In a distributed application architecture, there are multiple isolated filesystems. To ensure consistency across code services, code service filesystems are read-only. This prevents them from writing themselves out of sync, but it poses a problem in the case where an app does need to write to the filesystem.</p>
        
        <h3 id="the-problem">The Problem</h3>
        
        <p>Because each code service has its own isolated filsytem, anything written to the filesystem is inaccessable to other code services.</p>
        
        <p><strong>For example:</strong> An app allows users to upload images. Images are uploaded through web1, but then processed into smaller sizes by worker1. Because web1&#39;s filesystem is isolated, the worker would never be able to access the uploaded images.</p>
        
        <p><img alt="Network Storage Problem" src="/images/network-storage-problem-d4c20109.svg" width="430" style="display: block; margin: 0 auto;"></p>
        
        <h3 id="the-solution">The Solution</h3>
        
        <p>Network storage services provide a centralized filesystem shared between code services. Directories inside of code services to which files must be written/read can be specified as &quot;network directories&quot;. These directories are replaced with <a href="#network-mounts">network mounts</a> on deploy, which route requests to those directories across the network to the filesystem of the network storage service. This allows isolated code services to write to and read from a single writable filesystem. </p>
        
        <p><img alt="Network Storage Solution" src="/images/network-storage-solution-8dfccb37.svg" width="620" style="display: block; margin: 0 auto;"></p>
        
        <h2 id="how-network-storage-works">How Network Storage Works</h2>
        
        <p>Network storage services provide centralized writable filesystems sharable between multiple code services. For each code service, <code>network_dirs</code> can be specified in the <a href="/getting-started/boxfile">Boxfile</a>. On deploy, these directories are replaced with network mounts which route any requests to the directory or its contents across the app&#39;s private network to the correpsonding path inside of the storage service. This allows code services to access files stored in network storage using the same filepaths as if in local filesystem.</p>
        
        <h3 id="network-mounts">Network Mounts</h3>
        
        <p>Network mounts essentially replace those directories in your repo (and their contents) specified as network directories in your Boxfile. Anything inside of a network directory within your repo will not be accessible to your app until uploaded to the matching filepath inside of your storage service.</p>
        
        <h2 id="configuring-network-storage">Configuring Network Storage</h2>
        
        <p>Network storage services don&#39;t require much configuration. Really the only configurable option is the <code>name</code> of the service. Storage services use the <a href="https://en.wikipedia.org/wiki/Network_File_System" target="_blank">&quot;nfs&quot; file system protocol</a> and can be created/configured using the service ID <code>nfs1</code> (incremented up when using mulitple storage services). </p>
        
        <h4 id="network-storage-service-in-the-boxfile">Network Storage Service in the Boxfile</h4>
        <pre class="highlight yaml"><code><span class="s">nfs1</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">file-storage</span>&#x000A;</code></pre>
        
        <h3 id="network-directories">Network Directories</h3>
        
        <p>In order for a code service to be able to store files in a storage service, network directories must be added to the code service&#39;s configuration. Network directories are configured per code service using the <code>network_dirs</code> config.</p>
        
        <h4 id="network-directories-in-the-boxfile">Network Directories in the Boxfile</h4>
        <pre class="highlight yaml"><code><span class="s">web1</span><span class="pi">:</span>&#x000A;  <span class="s">network_dirs</span><span class="pi">:</span>&#x000A;    <span class="pi">-</span> <span class="s">public/uploads</span>&#x000A;&#x000A;<span class="s">worker1</span><span class="pi">:</span>&#x000A;  <span class="s">network_dirs</span><span class="pi">:</span>&#x000A;    <span class="pi">-</span> <span class="s">public/uploads</span>&#x000A;&#x000A;<span class="s">nfs1</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">file-storage</span>&#x000A;</code></pre>
        
        <h6 id="things-to-note">Things to Note:</h6>
        
        <ul>
        <li>Filepaths of <code>network_dirs</code> are relative to the root of your app&#39;s repo.</li>
        <li>If multiple code services need to share network directories, the <code>network_dirs</code> config must be included in all the code services.</li>
        <li>If a code service includes <code>network_dirs</code> but no storage service is included in the Boxfile, a <code>nfs1</code> service will automatically be created.</li>
        </ul>
        
        <h3 id="network-directories-with-multiple-storage-services">Network Directories with Multiple Storage Services</h3>
        
        <p>It&#39;s possible to have multilple storage services in an app, with specific network directories stored on each. When using multiple storage services, you can specify which should be used be used by nesting the ID of the desired storage service under <code>network_dirs</code> config, then specifying the directory paths.</p>
        
        <h4 id="network-directories-for-mutliple-storage-services">Network Directories for Mutliple Storage Services</h4>
        <pre class="highlight yaml"><code><span class="s">web1</span><span class="pi">:</span>&#x000A;  <span class="s">network_dirs</span><span class="pi">:</span>&#x000A;    <span class="s">nfs1</span><span class="pi">:</span>&#x000A;      <span class="pi">-</span> <span class="s">public/uploads</span>&#x000A;    <span class="s">nfs2</span><span class="pi">:</span>&#x000A;      <span class="pi">-</span> <span class="s">public/processed</span>&#x000A;&#x000A;<span class="s">worker1</span><span class="pi">:</span>&#x000A;  <span class="s">network_dirs</span><span class="pi">:</span>&#x000A;    <span class="s">nfs1</span><span class="pi">:</span>&#x000A;      <span class="pi">-</span> <span class="s">public/uploads</span>&#x000A;    <span class="s">nfs2</span><span class="pi">:</span>&#x000A;      <span class="pi">-</span> <span class="s">public/processed</span>&#x000A;&#x000A;<span class="s">nfs1</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">queued_images</span>&#x000A;&#x000A;<span class="s">nfs2</span><span class="pi">:</span>&#x000A;  <span class="s">name</span><span class="pi">:</span> <span class="s">processed_images</span>&#x000A;</code></pre>
        
        <h2 id="managing-network-storage">Managing Network Storage</h2>
        
        <p>Network directories and their contents can be managed through an SSH connection into your storage service. More information is availble in the <a href="/getting-started/shell-access">Shell Access doc</a>.</p>
        <div id='pagination'>
          <a class="prev" href="/getting-started/tunneling/">Tunneling</a>
          <a class="next" href="/getting-started/nonpersistent-writable-dirs/">Nonpersistent Writable Directories</a>
        </div>
      </div>
    </div>
    <div id='footer'></div>
  </body>
</html>
