<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <!-- favicon -->
    <link href='/images/favicon.ico' rel='icon' type='image/png'>
    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>
      Scripts - Nanobox Documentation
    </title>
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href="/stylesheets/all-46aa5565.css" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all-2eb6cf05.js" type="text/javascript"></script>
  </head>
  <body>
    <div id='header'>
      <a class='left' href='/' id='logo'>
        <svg enable-background='new 0 0 19 33' id='nanobox-logo' space='preserve' version='1.1' viewbox='0 0 19 33' x='0px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' y='0px'>
          <g>
            <g>
              <polygon fill='#405C70' points='19,26 9.6,30.9 0,26 9.4,21.1'></polygon>
              <polygon fill='#2F4352' points='15,24 9.5,26.9 3.9,24 9.4,21.1'></polygon>
              <polygon fill='#1C2830' points='9.6,30.9 19,26.1 19,27.4 9.6,32.3 '></polygon>
              <polygon fill='#19242B' points='9.6,30.9 0,26 0,27.3 9.6,32.3 '></polygon>
            </g>
            <g>
              <polygon fill='#1E77A3' points='9.5,23.1 17.2,19.1 17.2,20.3 9.5,24.2 '></polygon>
              <polygon fill='#175D80' points='9.5,23.1 1.8,19.1 1.8,20.3 9.5,24.2 '></polygon>
              <polygon fill='#62B1DD' points='17.2,19.1 9.5,23.1 1.8,19.1 9.5,15.2'></polygon>
              <polygon enable-background='new' fill='#0B194F' opacity='0.42' points='15.1,18.1 9.5,21 3.9,18.1 9.5,15.2 '></polygon>
            </g>
            <g>
              <polygon fill='#43C494' points='9.5,16.9 18.8,12.2 18.8,13.5 9.5,18.3 '></polygon>
              <polygon fill='#4AAA88' points='9.5,16.9 0.2,12.2 0.2,13.5 9.5,18.3 '></polygon>
              <polygon fill='#7FE0BF' points='18.8,12.2 9.5,16.9 0.2,12.2 9.5,7.4 '></polygon>
              <polygon enable-background='new' fill='#43C4A6' opacity='0.76' points='16.3,10.9 9.5,14.4 2.7,10.9 9.5,7.4'></polygon>
            </g>
            <g>
              <polygon fill='#FDE5A6' points='18.8,4.8 9.5,9.6 0.2,4.8 9.5,0'></polygon>
              <polygon fill='#E9D399' points='9.5,9.6 18.8,4.8 18.8,6.2 9.5,11'></polygon>
              <polygon fill='#D9BB6F' points='9.5,9.6 0.2,4.8 0.2,6.2 9.5,11'></polygon>
            </g>
          </g>
        </svg>
        <span id='nb-title'>
          <span class='drop'>Nanobox</span>
          Docs
        </span>
      </a>
      <ul class='links'>
        <li class='text'>
          <a class='active' href='/'>
            Local
          </a>
        </li>
        <li class='text'>
          <a href='/production/intro/'>
            Production
          </a>
        </li>
        <li>
          <a href='http://nanobox.io'>
            <svg enable-background='new 0 0 18 18' id='home-icon' space='preserve' version='1.1' viewbox='0 0 18 18' x='0px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' y='0px'>
              <polygon fill='none' points='11,13 11,9 9,7 7,9 &#x000A;	7,13 ' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2'></polygon>
              <polyline fill='none' points='14,11 14,16 4,16 &#x000A;	4,11 ' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2'></polyline>
              <polyline fill='none' points='2,9.1 9.1,2 &#x000A;	16.1,9.1 ' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2'></polyline>
            </svg>
          </a>
        </li>
      </ul>
    </div>
    <div id='wrapper'>
      <div class='open' id='contents-btn'>Contents</div>
      <div id='navigation'>
        <ul class='closed' id='contents'>
          <li>
            <a href="/">Overview</a>
          </li>
          <li>
            <a href="/why-nanobox/">Why Nanobox?</a>
          </li>
          <li>
            <a href="/installation/installing-nanobox/">Installation</a>
            <ul class='sub'>
              <li>
                <a href="/installation/upgrading/">Upgrading</a>
              </li>
              <li>
                <a href="/installation/uninstalling/">Uninstalling</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/getting-started/intro/">Getting Started</a>
            <ul class='sub'>
              <li>
                <a href="/getting-started/project-setup/">Project Setup</a>
              </li>
              <li>
                <a href="/getting-started/nanofile/">.nanofile</a>
              </li>
              <li>
                <a href="/getting-started/boxfile/">Boxfile</a>
              </li>
              <li>
                <a href="/getting-started/engines/">Engines</a>
              </li>
              <li>
                <a href="/getting-started/services/">Services</a>
              </li>
              <li>
                <a href="/getting-started/logs/">Logs</a>
              </li>
              <li>
                <a href="/getting-started/deploys/">Deploys</a>
              </li>
              <li>
                <a href="/getting-started/tunneling/">Tunneling</a>
              </li>
              <li>
                <a href="/getting-started/network-storage/">Network Storage</a>
              </li>
              <li>
                <a href="/getting-started/nonpersistent-writable-dirs/">Nonpersistent Writable Directories</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/cli/intro/">Command Line Interface</a>
            <ul class='sub'>
              <li>
                <a href="/cli/bootstrap/">bootstrap</a>
              </li>
              <li>
                <a href="/cli/build/">build</a>
              </li>
              <li>
                <a href="/cli/console/">console</a>
              </li>
              <li>
                <a href="/cli/create/">create</a>
              </li>
              <li>
                <a href="/cli/deploy/">deploy</a>
              </li>
              <li>
                <a href="/cli/destroy/">destroy</a>
              </li>
              <li>
                <a href="/cli/exec/">exec</a>
              </li>
              <li>
                <a href="/cli/fetch/">fetch</a>
              </li>
              <li>
                <a href="/cli/halt/">halt</a>
              </li>
              <li>
                <a href="/cli/help/">help</a>
              </li>
              <li>
                <a href="/cli/init/">init</a>
              </li>
              <li>
                <a href="/cli/log/">log</a>
              </li>
              <li>
                <a href="/cli/new/">new</a>
              </li>
              <li>
                <a href="/cli/publish/">publish</a>
              </li>
              <li>
                <a href="/cli/reload/">reload</a>
              </li>
              <li>
                <a href="/cli/resume/">resume</a>
              </li>
              <li>
                <a href="/cli/status/">status</a>
              </li>
              <li>
                <a href="/cli/suspend/">suspend</a>
              </li>
              <li>
                <a href="/cli/tunnel/">tunnel</a>
              </li>
              <li>
                <a href="/cli/up/">up</a>
              </li>
              <li>
                <a href="/cli/update/">update</a>
              </li>
              <li>
                <a href="/cli/upgrade/">upgrade</a>
              </li>
              <li>
                <a href="/cli/watch/">watch</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/boxfile/intro/">Boxfile</a>
            <ul class='sub'>
              <li>
                <a href="/boxfile/env/">env</a>
              </li>
              <li>
                <a href="/boxfile/build/">build</a>
              </li>
              <li>
                <a href="/boxfile/code-services/">Code Services</a>
              </li>
              <li>
                <a href="/boxfile/data-services/">Data Services</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/engines/intro/">Engines</a>
            <ul class='sub'>
              <li>
                <a href="/engines/how-engines-work/">How Engines Work</a>
              </li>
              <li>
                <a href="/engines/boxfile-spec/">Generating a Boxfile</a>
              </li>
              <li>
                <a href="/engines/project-creation/">Project Creation</a>
              </li>
              <li>
                <a href="/engines/enginefile/">Enginefile</a>
              </li>
              <li>
                <a href="/engines/style-guide/">Style Guide</a>
              </li>
              <li class='active'>
                <a href="/engines/scripts/intro/">Scripts</a>
                <ul class='sub'>
                  <li>
                    <a href="/engines/scripts/sniff/">sniff</a>
                  </li>
                  <li>
                    <a href="/engines/scripts/boxfile/">boxfile</a>
                  </li>
                  <li>
                    <a href="/engines/scripts/prepare/">prepare</a>
                  </li>
                  <li>
                    <a href="/engines/scripts/build/">build</a>
                  </li>
                  <li>
                    <a href="/engines/scripts/cleanup/">cleanup</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="/engines/common-tasks/intro/">Common Tasks</a>
                <ul class='sub'>
                  <li>
                    <a href="/engines/common-tasks/installing-binaries/">Installing Binaries</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/generating-output/">Generating Output</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/working-with-input/">Working with Input</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/validation/">Validation</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/caching/">Caching</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/environment-variables/">Environment Variables</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/template-generation/">Template Generation</a>
                  </li>
                  <li>
                    <a href="/engines/common-tasks/application-config/">Application Configuration</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="/engines/publish/">Publish</a>
              </li>
              <li>
                <a href="/engines/dev-workflow/">Development Workflow</a>
              </li>
              <li>
                <a href="/engines/debugging/">Debugging</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="/other/intro/">Other</a>
          </li>
        </ul>
      </div>
      <div id='content'>
        <h1>Scripts</h1>
        <p>A Nanobox engine is literally a collection of scripts. When an app is deployed, Nanobox attempts to determine the most appropriate engine to use. Once the engine has been selected, the deploy process is executed across 4 phases. A script must exist within the engine to properly determine if the engine applies to the app, and to handle each phase. For more details on the overview of the deploy process, refer to the <a href="/engines/how-engines-work">How Engines Work doc</a>.</p>
        
        <h2 id="general-guidelines">General Guidelines</h2>
        
        <h4 id="bash">bash</h4>
        
        <p>It is <strong>highly</strong> recommended that engine scripts be written in bash. Here are a few reasons to consider:</p>
        
        <ol>
        <li>Bash is available in every Nanobox image.</li>
        <li>The <a href="/engines/common-tasks">nos</a> framework is available to bash, and will greatly simplify engine development.</li>
        <li>Bash is a common language for server scripting, and assistance across engines can be aided with a unified language.</li>
        </ol>
        
        <p>While it is possible to write scripts in an alternative language, it is highly discouraged. In addition, an alternative language or runtime will need to be installed prior to executing the scripts. This is possible, but since we don&#39;t recommend it, the processes will not be documented. If you really need to use a different language, hop in the <a href="http://webchat.freenode.net/?channels=nanobox&amp;uio=d4">#nanobox irc</a> to find out how.</p>
        
        <h4 id="executable">executable</h4>
        
        <p><strong>Don&#39;t forget to chmod the scripts to be executable.</strong> The scripts are run directly, so the scripts will fail if they aren&#39;t executable. This can be done easily with the following command, executed from the engine root:</p>
        <pre class="highlight shell"><code><span class="gp">$ </span>chmod +x bin/<span class="k">*</span>&#x000A;</code></pre>
        
        <h4 id="no-extension">no extension</h4>
        
        <p>The scripts are executed from Nanobox directly, without an extension. Adding an extension will prevent Nanobox from finding the script.</p>
        
        <h2 id="payload">Payload</h2>
        
        <p>With the exception of the <a href="/engines/scripts/sniff">sniff</a> script, all engine scripts will be called with a single argument – a JSON payload. A single argument containing a payload is used instead of multiple arguments or even environment variables mostly due to the potential for nested data structures and the dynamic nature of the attributes. JSON is used as it is a simple data structure that most languages can natively encode and decode.</p>
        
        <h4 id="json-in-bash">JSON in bash?</h4>
        
        <p>Right, bash doesn&#39;t actually handle JSON. In fact, bash doesn&#39;t handle any common structured object notation. The Nanobox team created <a href="https://github.com/pagodabox/shon">SHON</a> (&quot;SHell Object Notation&quot;), a nested data structure that bash can work with, and a tool to convert from JSON to SHON. Check out the project and the documentation if you&#39;re interested. Though, it&#39;s unlikely that you&#39;ll need to work with SHON, as the <a href="/engines/common-tasks">nos</a> framework performs the translation and exposes helpers that access the data for you.</p>
        
        <h4 id="payload-data">Payload Data</h4>
        
        <p>The JSON payload provided as the first argument to the script contains the following keys:</p>
        
        <ul>
        <li><strong>code_dir</strong> : Path to the code staging directory. This is a copy of the code, where the transformation, build or compile should happen.</li>
        <li><strong>build_dir</strong> : Path the the directory where binaries, runtimes, and configuration is stored. (ie: ruby, nginx, apache.conf, etc) This directory is available in the production environment.</li>
        <li><strong>live_dir</strong> : This is the directory where the final build should be copied into. This directory is also available in the production environment.</li>
        <li><strong>cache_dir</strong> : A cache store that is persistent between deploys.</li>
        <li><strong>etc_dir</strong> : A sub-directory within the build_dir. This is where runtime configurations should live. (ie: apache.conf, nginx.conf, unicorn.rb etc).</li>
        <li><strong>env_dir</strong> : Path to the directory where environment variables to be made available to the production environment live. For more information, see <a href="/engines/common-tasks/environment-variables">here</a>.</li>
        <li><strong>app</strong> : The name of the app.</li>
        <li><strong>env</strong> : A list of key/value pairs representing environment variables that can be made available to the build or production environment. For more information, see <a href="/engines/common-tasks/environment-variables">here</a>.</li>
        <li><strong>dns</strong> : A list of dns aliases that are associated with this app. May be used to generate webserver configurations.</li>
        <li><strong>port</strong> : The tcp port that this app should bind to, for the app to recieve traffic from the load balancer.</li>
        <li><strong>boxfile</strong> : The build section of the Boxfile provided by the application.</li>
        <li><strong>platform</strong> : &quot;local&quot; or &quot;production&quot;. Can be used to conditionally tailor the deploy for the specified platform.</li>
        </ul>
        
        <h2 id="common-tasks-and-workflow">Common Tasks and Workflow</h2>
        
        <p>How to use the data from the payload above, as well as common scenarios and workflows are addressed in full in the <a href="/engines/common-tasks/intro">Common Tasks</a> doc.</p>
        <div id='pagination'>
          <a class="prev" href="/engines/style-guide/">Style Guide</a>
          <a class="next" href="/engines/scripts/sniff/">sniff</a>
        </div>
      </div>
    </div>
    <div id='footer'></div>
  </body>
</html>
